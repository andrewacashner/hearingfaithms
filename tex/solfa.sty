\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tex/solfa}[2020/02/10 Solmization diagram]

\RequirePackage{xparse}
\RequirePackage{graphicx}
\RequirePackage[normalem]{ulem}

\newlength{\solfalevel}
\setlength{\solfalevel}{6ex}
\newlength{\minim}
\setlength{\minim}{2em}

% #1 optional star for when syllable matches lyric text,
% #2 length in minims, 
% #3 solmization syllables
\NewDocumentCommand{\solfa}{ s m m }{%
    \makebox[#2\minim][l]{%
        \IfBooleanTF{#1}{\emph{#3}}{#3}%
    }\ignorespaces
}

% #1 hexachord name, typeset below rule and \BODY (solfa syllables)
\RequirePackage{environ}
\NewEnviron{hexachord}[1]{%
    \leavevmode\rlap{\textsc{#1}}%
    {\raisebox{\baselineskip}{\uline{\BODY}}}%
}

% Overlap next hexachord and previous by specified number of minims
\NewDocumentCommand{\mutate}{ O{1} }{%
    \kern-#1\minim\ignorespaces
}

% Shift argument up specified number of \solfalevel
\NewEnviron{levelup}[1]{%
    \raisebox{#1\solfalevel}{\BODY}\ignorespaces
}

\endinput
